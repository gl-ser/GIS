# GIS
Движок геоинформационной системы

Использует функционал:

- Qt 5;
- кватернионно-векторно-матричной библиотеки [QuatVectMatr](https://github.com/gl-ser/QuatVectMatr);
- библиотеки логических манипуляций над множествами [Multitude](https://github.com/gl-ser/Multitude).

Реализует основные возможности геоинформационной системы, необходимые для создания приложений, интерфейс пользователя которых основан на действиях с электронной картой местности.

Состоит из 8 классов: TCartography, TView, TScene, TFrame, TLayer, TMapData, TGISLib, TShellGIS.

---

### 1. TCartography класс картографических преобразований
Является основным аппаратом вычислительной математики в движке геоинформационной системы.

#### Публичные методы
1.1. _ScreenXYToPZ90BL_ переводит сценические координаты в геодезические координаты эллипсоида ПЗ-90, используя текущую проекцию

На вход подаются:

  - абсцисса ScreenX сценических координат;
  - ордината ScreenY сценических координат.

На выходе можно получить:

  - геодезическая широта B [рад];
  - геодезическая долгота L [рад].

Синтаксис:

```cpp
void ScreenXYToPZ90BL(double ScreenX, double ScreenY, double* B, double* L)
```

1.2. _PZ90BLToScreenXY_ переводит геодезические координаты эллипсоида ПЗ-90 в сценические координаты, используя текущую проекцию

На вход подаются:

  - геодезическая широта B [рад];
  - геодезическая долгота L [рад].

На выходе можно получить:

  - абсцисса ScreenX сценических координат;
  - ордината ScreenY сценических координат.

Синтаксис:

```cpp
void PZ90BLToScreenXY(double B, double L, double* ScreenX, double* ScreenY)
```

1.3. _RulerLength_ вычисляет длину геодезической линии между указанными точками

На вход подаются:

  - геодезическая широта B начала линии [рад];
  - геодезическая долгота L начала линии [рад];
  - геодезическая широта B конца линии [рад];
  - геодезическая долгота L конца линии [рад].

На выходе можно получить:

  - длину геодезической линии на эллипсоиде ПЗ-90 [м].

Синтаксис:

```cpp
double RulerLength(double StartB, double StartL, double StopB, double StopL)
```

#### Публичные свойства
1.4. _SysCoord_ свойство Объект умеет преобразовывать системы координат (экземпляр класса TEarthSatellite)

Синтаксис:

```cpp
TEarthSatellite* SysCoord
```

1.5. _Geometry_ свойство Объект реализует геометрические построения (экземпляр класса TEasyGeometry)

Синтаксис:

```cpp
TEasyGeometry* Geometry
```

1.6. _OWNER_ свойство Указатель на объект класса-владельца

Синтаксис:

```cpp
void* OWNER
```

---

### 2. TView класс, реализующий «вид» для отрисовки картографической сцены
Расширяет возможности «вида» из Qt для отрисовки картографической сцены.

#### Публичный тип
```cpp
//Инструменты по работе с картой
enum TTool
{
  MOVE = 1,   //Движение карты
  RULER = 2,  //Линейка
  ARROW = 3   //Стрелка
};
```
#### Публичные методы
2.1. _SetCursor_ устанавливает вид курсора в соответствии с инструментом по работе с картой

Синтаксис:

```cpp
void SetCursor(TTool Value)
```

2.2. _CloseHint_ закрывает всплывающую подсказку

Синтаксис:

```cpp
void CloseHint(void)
```
#### Публичное свойство
2.3. _OWNER_ свойство Указатель на объект класса-владельца

Синтаксис:

```cpp
void* OWNER
```

---

### 3. TScene класс графической сцены
Расширяет возможности графической сцены из Qt.
#### Публичный сигнал
3.1. _GetDataRightMouse_ сигнал Обработка события щелчка правой кнопки "мыши"

Возвращает экранные и геодезические координаты, список объектов карты по координатам

Синтаксис:

```cpp
void GetDataRightMouse(QPoint Value1, TOnePoint Value2, TMapData::TObjList Objects)
```

#### Публичное свойство
3.2. _OWNER_ свойство Указатель на объект класса-владельца

Синтаксис:

```cpp
void* OWNER
```

---

### 4. TFrame класс, реализующий рамку карты и 15-градусную сетку
#### Публичные методы
4.1. _Add_ добавить рамку на карту

Синтаксис:

```cpp
void Add(void)
```

4.2. _Del_ удалить рамку карты

Синтаксис:

```cpp
void Del(void)
```

4.3. _RePaint_ перерисовать рамку

Синтаксис:

```cpp
void RePaint(void)
```

4.4. _AddGrid_ добавить 15-градусную сетку на карту

Синтаксис:

```cpp
void AddGrid(void)
```

4.5. _DelGrid_ удалить 15-градусную сетку

Синтаксис:

```cpp
void DelGrid(void)
```

4.6. _RePaintGrid_ перерисовать 15-градусную сетку

Синтаксис:

```cpp
void RePaintGrid(void)
```

4.7. _GetGrid_ возвращает 15-градусную сетку

Синтаксис:

```cpp
TArraySpot GetGrid(void)
```

#### Публичное свойство
4.8. _OWNER_ свойство Указатель на объект класса-владельца

Синтаксис:

```cpp
void* OWNER
```

### 5. TLayer класс картографического слоя
Слой – основное понятие, с которым сталкивается пользователь при выведении графической информации на электронную карту.
#### Публичные типы

```cpp
//Тип символа, изображающего объект "точка" в слое
enum TTypeSymbol
{
  NONE_SYMBOL = 0,    //Не задан
  CIRCLE_SYMBOL = 1,  //Круг
  RECT_SYMBOL = 2     //Квадрат
};


//Тип объекта в слое
enum TTypeObj
{
  NONE_OBJ = 0,      //Не задан
  POINT_OBJ = 1,     //Точка
  POLYLINE_OBJ = 2,  //Полилиния
  REGION_OBJ = 3     //Регион
};


//Полушарие Земли, в котором располагается объект
enum THemisphere
{
  NONE_HEM = 0,   //Не задано
  NORTH_HEM = 1,  //Северное полушарие
  SOUTH_HEM = 2,  //Южное полушарие
  BOTH_HEM = 3    //Оба полушария (северное и южное)
};


//Тип описывает параметры объекта "точка" в слое
struct ObjPoint
{
  ObjPoint() : Type(NONE_SYMBOL), Pen(NULL), Brush(NULL) {}
  TTypeSymbol Type;  //Тип символа, изображающего объект "точка"
  TOnePoint Point;   //Геодезические координаты объекта "точка"
  QPen *Pen;         //Перо для рисования объекта "точка"
  QBrush *Brush;     //Заливка для рисования объекта "точка"
};
typedef struct ObjPoint TObjPoint;


//Тип описывает параметры объекта "полилиния" в слое
struct ObjPolyLine
{
  ObjPolyLine() : Pen(NULL) {}
  TSpot Spot;  //Геодезические координаты узловых точек полилинии
  QPen *Pen;   //Перо для рисования объекта "полилиния"
};
typedef struct ObjPolyLine TObjPolyLine;


//Тип описывает параметры объекта "регион" в слое
struct ObjRegion
{
  ObjRegion() : Pen(NULL), Brush(NULL) {}
  TSpot Spot;     //Геодезические координаты узловых точек региона
  QPen *Pen;      //Перо для рисования объекта "регион"
  QBrush *Brush;  //Заливка для рисования объекта "регион"
};
typedef struct ObjRegion TObjRegion;


//Тип описывает заголовок одного объекта в слое
struct HeaderOfObj
{
  HeaderOfObj() : ID(0), Name("") {}
  unsigned int ID;   //Идентификатор объекта
  std::string Name;  //Наименование объекта
};
typedef struct HeaderOfObj THeaderOfObj;


//Тип описывает все заголовки объектов в слое
typedef std::vector<THeaderOfObj> THeadersObjects;


//Тип описывает параметры одного объекта в слое
struct Obj
{
  Obj() : HandlePointAsEllipse(NULL), HandlePointAsRect(NULL), 
          HandleRegion(NULL), HandlePolyLine(NULL), Hemisphere(NONE_HEM), 
          Type(NONE_OBJ) {}
  QGraphicsEllipseItem *HandlePointAsEllipse;  //Указатель на item кружочка, 
          // помещенного на сцену. Пользователь не заполняет
  QGraphicsRectItem *HandlePointAsRect;  //Указатель на item квадрата, 
          // помещенного на сцену. Пользователь не заполняет
  QGraphicsPolygonItem *HandleRegion;  //Указатель на item полигона, 
          // помещенного на сцену. Пользователь не заполняет
  QGraphicsPathItem *HandlePolyLine;  //Указатель на item полилинии, 
          // помещенной на сцену. Пользователь не заполняет
  THeaderOfObj Header;     //Заголовок объекта
  THemisphere Hemisphere;  //Полушарие Земли, в котором располагается объект
  TTypeObj Type;           //Тип объекта
  TObjPoint Point;         //Тип объекта POINT_OBJ - "точка"
  TObjPolyLine PolyLine;   //Тип объекта POLYLINE_OBJ - "полилиния"
  TObjRegion Region;       //Тип объекта REGION_OBJ - "регион"
};
typedef struct Obj TObj;


//Тип описывает параметры всех объектов в слое
typedef std::vector<TObj> TObjects;
```

#### Публичные методы
7.5.1. _RGBToMI_ переводит цвета R, G, B в код цвета MapInfo

На вход подаются:

  - красный;
  - зеленый;
  - синий.

На выходе можно получить:

  - цвет в формате MapInfo.

Синтаксис:

```cpp
void RGBToMI(int R, int G, int B, int* MI)
```

7.5.2. _MIToRGB_ переводит цвета R, G, B в код цвета MapInfo

На вход подаются:

  - цвет в формате MapInfo.

На выходе можно получить:

  - красный;
  - зеленый;
  - синий.

Синтаксис:

```cpp
void MIToRGB(int MI, int* R, int* G, int* B)
```

7.5.3. _PenMIToQPen_ переводит перо формата MapInfo в формат QPen
На вход подаются:

  - ширина линии в формате MapInfo;
  - тип линии в формате MapInfo;
  - цвет линии в формате MapInfo.

На выходе можно получить:

  - перо QPen.

Синтаксис:

```cpp
QPen PenMIToQPen(int WidthMI, int PatternMI, int ColorMI)
```

7.5.4. _BrushMIToQBrush_ переводит заливку формата MapInfo в формат QBrush
На вход подаются:
  - тип штриховки в формате MapInfo;
  - цвет штриховки в формате MapInfo.
На выходе можно получить:
  - заливку QBrush.
Синтаксис:
QBrush BrushMIToQBrush(int PatternMI, int ColorMI)


7.5.5. _RePaint_ быстро перерисовать слой
Синтаксис:
void RePaint(void)


7.5.6. _CoolRePaint_ перерисовать слой путем удаления и создания всех его объектов
Синтаксис:
void CoolRePaint(void)


7.5.7. _Hide_ скрыть (девизуализировать) слой
Синтаксис:
void Hide(void)


7.5.8. _Show_ показать (визуализировать) слой
Синтаксис:
void Show(void)


7.5.9. _GetVisible_ возвращает признак визуализации слоя
Синтаксис:
bool GetVisible(void)


7.5.10. _GetStringObj_ возвращает строку (содержащую имя слоя и имя объекта) по указателю, если такой объект найдется в слое
Синтаксис:
std::string GetStringObj(QGraphicsItem* ID)


7.5.11. _GetHeaderObj_ возвращает заголовок объекта по указателю, если такой объект найдется в слое
Синтаксис:
THeaderOfObj GetHeaderObj(QGraphicsItem* ID)


7.5.12. _GetFreeID_ возвращает минимальное свободное значение идентификатора для размещения нового объекта в слое
На выходе можно получить:
  - свободное значение идентификатора объекта.
Синтаксис:
unsigned int GetFreeID(void)


7.5.13. _GetObjList_ возвращает список заголовков объектов в слое
Синтаксис:
THeadersObjects GetObjList(void)


7.5.14. _FindObj_ ищет объект, обратившись к нему по идентификатору
Синтаксис:
int FindObj(unsigned int ID);


7.5.15. _AddPolyLineQuick_ добавляет в слой объект типа "полилиния"
Добавление объекта в слой не вызывает перерисовку слоя. Следует пользоваться методом RePaint.
На вход подаются:
  - идентификатор объекта;
  - наименование объекта;
  - геодезические координаты узловых точек полилинии на эллипсоиде ПЗ-90 [рад];
  - перо для рисования объекта "полилиния".
Синтаксис:
void AddPolyLineQuick(unsigned int ID, std::string Name, TSpot Spot, QPen Pen)


7.5.16. _AddRegionQuick_ добавляет в слой объект типа "регион"
Добавление объекта в слой не вызывает перерисовку слоя. Следует пользоваться методом RePaint.
На вход подаются:
  - идентификатор объекта;
  - наименование объекта;
  - геодезические координаты узловых точек региона на эллипсоиде ПЗ-90 [рад];
  - перо для рисования объекта "регион";
  - заливка для рисования объекта "регион".
Синтаксис:
void AddRegionQuick(unsigned int ID, std::string Name, TSpot Spot, QPen Pen, QBrush Brush)


7.5.17. _AddPointQuick_ добавляет в слой объект типа "точка"
Добавление объекта в слой не вызывает перерисовку слоя. Следует пользоваться методом RePaint.
На вход подаются:
  - идентификатор объекта;
  - наименование объекта;
  - тип символа, изображающего объект "точка";
  - геодезические координаты объекта "точка" на эллипсоиде ПЗ-90 [рад];
  - перо для рисования объекта "точка";
  - заливка для рисования объекта "точка".
Синтаксис:
void AddPointQuick(unsigned int ID, std::string Name, TTypeSymbol Type, TOnePoint Point, QPen Pen, QBrush Brush)


7.5.18. _AddPoint_ добавляет в слой объект типа "точка"
Добавление объекта в слой не вызывает перерисовку слоя. Следует пользоваться методом RePaint.
На вход подаются:
  - идентификатор объекта;
  - наименование объекта;
  - тип символа, изображающего объект "точка";
  - геодезические координаты объекта "точка" на эллипсоиде ПЗ-90 [рад];
  - перо для рисования объекта "точка";
  - заливка для рисования объекта "точка".
На выходе можно получить:
  - true в случае успешного выполнения процедуры;
  - false в случае какой-либо ошибки.
Синтаксис:
bool AddPoint(unsigned int ID, std::string Name, TTypeSymbol Type, TOnePoint Point, QPen Pen, QBrush Brush)


7.5.19. _AddPolyLine_ добавляет в слой объект типа "полилиния"
Добавление объекта в слой не вызывает перерисовку слоя. Следует пользоваться методом RePaint.
На вход подаются:
  - идентификатор объекта;
  - наименование объекта;
  - геодезические координаты узловых точек полилинии на эллипсоиде ПЗ-90 [рад];
  - перо для рисования объекта "полилиния".
На выходе можно получить:
  - true в случае успешного выполнения процедуры;
  - false в случае какой-либо ошибки.
Синтаксис:
bool AddPolyLine(unsigned int ID, std::string Name, TSpot Spot, QPen Pen)


7.5.20. _AddRegion_ добавляет в слой объект типа "регион"
Добавление объекта в слой не вызывает перерисовку слоя. Следует пользоваться методом RePaint.
На вход подаются:
  - идентификатор объекта;
  - наименование объекта;
  - геодезические координаты узловых точек региона на эллипсоиде ПЗ-90 [рад];
  - перо для рисования объекта "регион";
  - заливка для рисования объекта "регион".
На выходе можно получить:
  - true в случае успешного выполнения процедуры;
  - false в случае какой-либо ошибки.
Синтаксис:
bool AddRegion(unsigned int ID, std::string Name, TSpot Spot, QPen Pen, QBrush Brush)


7.5.21. _DelObj_ удаляет объект любого типа из слоя
На вход подаются:
  - идентификатор объекта.
На выходе можно получить:
  - true в случае успешного выполнения процедуры;
  - false в случае какой-либо ошибки.
Синтаксис:
bool DelObj(unsigned int ID)
Публичные свойства:
7.5.22. _Objects_ свойство Объекты, содержащиеся в слое
Синтаксис:
TObjects Objects


7.5.23. _Name_ свойство Имя слоя (обязательно к заполнению)
Синтаксис:
std::string Name


7.5.24. _OWNER_ свойство Указатель на объект класса-владельца
Синтаксис:
void* OWNER

